# Template Variables Reference

This document describes the variables available when creating custom Jinja2 templates for MiniBook.

## Available Variables

When you create a custom template for the HTML output format, the following variables are available:

| Variable | Type | Description |
|----------|------|-------------|
| `title` | str | The title of the minibook |
| `description` | str \| None | Optional subtitle/description |
| `links` | list[tuple[str, str]] | List of (name, url) tuples |
| `timestamp` | str | Generation timestamp (YYYY-MM-DD HH:MM:SS) |
| `repository_url` | str | GitHub repository URL |
| `nonce` | str | CSP nonce for inline scripts/styles |

## Variable Details

### `title`

The main title of the minibook, passed via the `--title` CLI option.

```jinja2
<h1>{{ title }}</h1>
```

### `description`

Optional subtitle or description, passed via the `--subtitle` CLI option. May be `None`.

```jinja2
{% if description %}
<p class="subtitle">{{ description }}</p>
{% endif %}
```

### `links`

A list of tuples where each tuple contains `(name, url)`. Iterate to display links:

```jinja2
<ul>
{% for name, url in links %}
    <li><a href="{{ url }}">{{ name }}</a></li>
{% endfor %}
</ul>
```

### `timestamp`

The generation timestamp in `YYYY-MM-DD HH:MM:SS` format:

```jinja2
<footer>Generated on {{ timestamp }}</footer>
```

### `repository_url`

The GitHub repository URL, derived from the `GITHUB_REPOSITORY` environment variable or defaulting to `tschm/minibook`:

```jinja2
<a href="{{ repository_url }}">View Source</a>
```

### `nonce`

A unique cryptographic nonce for Content Security Policy. Use this for inline scripts and styles:

```jinja2
<script nonce="{{ nonce }}">
    // Your inline JavaScript
</script>

<style nonce="{{ nonce }}">
    /* Your inline CSS */
</style>
```

## Creating a Custom Template

### Basic Template Structure

```jinja2
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style nonce="{{ nonce }}">
        /* Your styles here */
        body { font-family: sans-serif; margin: 2rem; }
        h1 { color: #333; }
        ul { list-style-type: none; padding: 0; }
        li { margin: 0.5rem 0; }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .footer { margin-top: 2rem; font-size: 0.9rem; color: #666; }
    </style>
</head>
<body>
    <h1>{{ title }}</h1>

    {% if description %}
    <p>{{ description }}</p>
    {% endif %}

    <h2>Links</h2>
    <ul>
    {% for name, url in links %}
        <li><a href="{{ url }}">{{ name }}</a></li>
    {% endfor %}
    </ul>

    <div class="footer">
        <p>Generated by <a href="{{ repository_url }}">MiniBook</a> on {{ timestamp }}</p>
    </div>
</body>
</html>
```

### Using Your Custom Template

```bash
minibook --title "My Links" \
         --links '{"Google": "https://google.com"}' \
         --template /path/to/custom.j2 \
         --output ./output
```

## Security Considerations

### Autoescape

MiniBook enables Jinja2 autoescape by default for HTML templates. This means:

- User input in `title`, `description`, and link names is automatically HTML-escaped
- Special characters like `<`, `>`, `&`, `"` are converted to HTML entities
- This prevents XSS (Cross-Site Scripting) attacks

**Do NOT disable autoescape** unless you have a specific reason and understand the security implications.

### Content Security Policy (CSP)

The default template includes a strict CSP header. If you create a custom template:

1. Use the `nonce` variable for inline scripts and styles
2. Keep CSP restrictions as strict as possible
3. Avoid `unsafe-inline` and `unsafe-eval`

Example CSP meta tag:

```html
<meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'nonce-{{ nonce }}';
    style-src 'self' 'nonce-{{ nonce }}';
    img-src 'self' data:;
">
```

## Template Filters

Jinja2 provides many built-in filters. Commonly used ones:

```jinja2
{{ title | upper }}              {# UPPERCASE #}
{{ title | lower }}              {# lowercase #}
{{ title | title }}              {# Title Case #}
{{ description | default('No description') }}  {# Default value #}
{{ links | length }}             {# Number of links #}
{{ links | first }}              {# First link tuple #}
{{ links | last }}               {# Last link tuple #}
```

## Template Tests

Check conditions with Jinja2 tests:

```jinja2
{% if description is defined and description %}
    <p>{{ description }}</p>
{% endif %}

{% if links | length > 10 %}
    <p>Showing {{ links | length }} links</p>
{% endif %}
```

## Examples

### Minimal Template

```jinja2
<!DOCTYPE html>
<html>
<head><title>{{ title }}</title></head>
<body>
<h1>{{ title }}</h1>
<ul>
{% for name, url in links %}
<li><a href="{{ url }}">{{ name }}</a></li>
{% endfor %}
</ul>
</body>
</html>
```

### Template with Categories

If your links follow a naming convention like "Category: Name":

```jinja2
{% set categories = {} %}
{% for name, url in links %}
    {% if ': ' in name %}
        {% set cat, item = name.split(': ', 1) %}
        {% if cat not in categories %}
            {% set _ = categories.update({cat: []}) %}
        {% endif %}
        {% set _ = categories[cat].append((item, url)) %}
    {% endif %}
{% endfor %}

{% for category, items in categories.items() %}
<h2>{{ category }}</h2>
<ul>
{% for name, url in items %}
    <li><a href="{{ url }}">{{ name }}</a></li>
{% endfor %}
</ul>
{% endfor %}
```

### Dark Mode Support

```jinja2
<style nonce="{{ nonce }}">
    :root {
        --bg: #ffffff;
        --text: #333333;
        --link: #0066cc;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --bg: #1a1a1a;
            --text: #e0e0e0;
            --link: #66b3ff;
        }
    }

    body {
        background: var(--bg);
        color: var(--text);
    }

    a { color: var(--link); }
</style>
```
